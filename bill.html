<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Bill Details</title>
  <link rel="stylesheet" href="style.css">

  <style>

     body {
      display: flex;
      flex-direction: column;
        overflow-y: auto;  /* allow vertical scroll */
  min-height: 100vh; /* let body grow */

    
    }

    .row2 {
      display: flex;
      flex-direction: row;
    }

    .bill-details { border: 1px solid #c27f14; padding: 20px; }
   

    .summary, .sentiment-analysis, .personal-impact, .gen-quiz {
      padding: 15px;
      margin-top: 20px;
      border-left: 4px solid #c27f14;
      margin-left: 30px;
      background: #f7f3e9;
      height: 200px;    
      color: #91bdd7;
      width: 100%;
      max-width: 700px;
      font-family: Verdana, Geneva, Tahoma, sans-serif;
      font-size: 15px;  

}

  .sentiment-analysis {
    width: 40%;


    height: 450px;
  }

  .personal-impact {
    margin-top: -190px;
  }

  .gen-quiz {
    width: 500%;
    background-color: rgb(173, 226, 249);
    color:#f7f3e9;
  }

.source-title {
  font-weight: bold;
  font-size: 16px;
  margin-bottom: 6px;
  color: #b8756d;
}

.sentiment-bar {
  margin-top: 25px;
  margin-bottom: 25px;
}

.bar {
  width: 100%;
  background-color: #e0e0e0;
  border-radius: 8px;
  overflow: hidden;
  height: 22px;
  margin-bottom: 8px;
}

.fill {
  height: 100%;
  width: 0%;
  transition: width 0.5s ease-in-out;
}

.bbc-color {
  background-color: #90b9e1; /* blue */
}

.reuter-color {
  background-color: #ebc383; /* orange */
}

.confidence-text {
  font-weight: bold;
  font-size: 14px;
  color: #de7070; /* green confidence */
}


  </style>
</head>
<body>
  <body>
  <div id="bill-details">Loading...</div>

  <div class="row2">
    <div class="summary">
      <h2>ML generated summary that Tanush is supposed to generate goes here</h2>
    </div>

    <div class="sentiment-analysis">
  <h2>Sentiment Analysis</h2>

<div class="sentiment-bar" id="bbc-section">
  <div class="source-title">BBC News</div>
  <div class="bar">
    <div id="bbc-bar" class="fill bbc-color" style="width: 0%"></div>
  </div>
  <div class="confidence-text" id="bbc-confidence">Confidence: Loading...</div>
  <div class ="themes" id = "bbc-themes">focus topics: Loading...</div>
</div>

<div class="sentiment-bar" id="reuters-section">
  <div class="source-title">Reuters</div>
  <div class="bar">
    <div id="reuter-bar" class="fill reuter-color" style="width: 0%"></div>
  </div>
  <div class="confidence-text" id="reuter-confidence">Confidence: Loading...</div>
    <div class ="themes" id = "reuter-themes">focus topics: Loading...</div>

</div>

</div>
  </div>

  <div class="personal-impact">
    <h2>predictions about how bill impacts them live here</h2>
  </div>

  <div class="gen-quiz">
    <h2>generated Quiz lives here</h2>
  </div>



  <script type="module">
    let billTitle = ""
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCS07UgX2GnmuufEQET-RYOtm8i0XaZkWk",
      authDomain: "orwell-ea558.firebaseapp.com",
      databaseURL: "https://orwell-ea558-default-rtdb.firebaseio.com",
      projectId: "orwell-ea558",
      storageBucket: "orwell-ea558.firebasestorage.app",
      messagingSenderId: "301391502605",
      appId: "1:301391502605:web:67c58902e72044cd03a444"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    const billId = getQueryParam("id");
    const billRef = ref(db, `congress/bills/${billId}`);
    const container = document.getElementById('bill-details');


async function loadBillAndSentiment() {
  if (!billId) {
    container.innerHTML = "<p>No bill ID provided.</p>";
    return;
  }

  const billRef = ref(db, `congress/bills/${billId}`);

  try {
    const billSnap = await get(billRef);
    if (!billSnap.exists()) {
      container.innerHTML = "<p>Bill not found.</p>";
      return;
    }

    const bill = billSnap.val();
    billTitle = bill.title;

    container.innerHTML = `
      <div class="bill-details">
        <h1><strong>${bill.title}</strong></h1>
        <p><strong>Number:</strong> ${bill.number}</p>
        <p><strong>Type:</strong> ${bill.type}</p>
        <p><strong>Action Date:</strong> ${bill.actionDate || 'N/A'}</p>
        <p><strong>Update Date:</strong> ${bill.updateDate || 'N/A'}</p>
        <a href="${bill.url}" target="_blank">View on Congress.gov</a>
      </div>
    `;

    const sentimentSnap = await get(ref(db, 'sentiment'));
    if (sentimentSnap.exists()) {
      const sentiments = sentimentSnap.val();

      for (const query_text in sentiments) {
        const entry = sentiments[query_text];

        if (entry.query_text === bill.title) {
          const bbcScore = entry.bbc_com?.average_sentiment ?? 0;
          const reutersScore = entry.reuters_com?.average_sentiment ?? 0;
          const bbcConfidence = entry.bbc_com?.average_confidence ?? 0;
          const reutersConfidence = entry.reuters_com?.average_confidence ?? 0;

          document.getElementById('bbc-bar').style.width = `${bbcScore * 50}%`;
          document.getElementById('reuter-bar').style.width = `${reutersScore * 50}%`;

          document.getElementById('bbc-confidence').textContent = `Confidence: ${(bbcConfidence * 100).toFixed(1)}%`;
          document.getElementById('reuter-confidence').textContent = `Confidence: ${(reutersConfidence * 100).toFixed(1)}%`;

          break; 
        }
      }
    }

    const themesSnap = await get(ref(db, 'themes'));

    let matchedThemeEntry = null;

    if (themesSnap.exists()) {
      const allThemes = themesSnap.val();

      
    for (const key in allThemes) {
      const entry = allThemes[key];
      if (entry.bill === billTitle) {
    matchedThemeEntry = entry;
    break;
  }
}

        if (matchedThemeEntry) {
        const bbcThemes = (matchedThemeEntry.theme_bbc || []).map(t => t.theme);
        const reutersThemes = (matchedThemeEntry.theme_reuter || []).map(t => t.theme);

  document.getElementById('bbc-themes').textContent = 
    `Focus Topics: ${bbcThemes.join(", ") || "None"}`;
  document.getElementById('reuter-themes').textContent = 
    `Focus Topics: ${reutersThemes.join(", ") || "None"}`;
} else {
  document.getElementById('bbc-themes').textContent = 
    "Focus Topics: Not available.";
  document.getElementById('reuter-themes').textContent = 
    "Focus Topics: Not available.";
}
    } 

  } catch (err) {
    console.error("Error:", err);
    document.getElementById('bbc-confidence').textContent = "Error loading sentiment.";
    document.getElementById('reuter-confidence').textContent = "Error loading sentiment.";
  }
}



    loadBillAndSentiment();



    
  </script>
</body>
</html>